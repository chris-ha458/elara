import{r as o,cE as h,n as b,a5 as w,a8 as E,cF as d,cG as F}from"./index-2331aba4.js";import{ScenesContext as g}from"./scenes-e3aac35f.js";import{JukeboxContext as M}from"./jukebox-e4a62fbd.js";const U=()=>o.useContext(M),P=()=>o.useContext(h);function J(e,n){const u=JSON.stringify(n.params);return e.findIndex(s=>s.routeName===n.name&&JSON.stringify(s.routeParams)===u)}function m(e,n){const u=J(e,n);return u===void 0?null:e[u]}const x=()=>o.useContext(g),_=()=>o.useContext(g).filter(e=>e.type==="level"),O=()=>o.useContext(g).filter(e=>e.type==="journal");function y(){const e=x(),{route:n}=b(""),[u,s]=o.useState(m(e,n));return o.useEffect(()=>{s(m(e,n))},[n,e]),u}function L(){const e=x();for(let n=e.length-1;n>=0;n-=1)if(e[n].unlocked)return e[n];return e[0]}function D(){const e=_();for(let n=0;n<e.length;n+=1)if(!e[n].unlocked)return e[n];return e[e.length-1]}function j(){const e=y(),n=w(),u=O(),{getSoundOrNull:s}=E(),i=o.useRef(null),{requestSong:l,stopAllMusic:r}=U(),[S]=P(),a=o.useCallback(t=>{if(n.navigate(t.routeName,t.routeParams??{}),t.initialSound!=null){i.current&&clearTimeout(i.current);const c=s(t.initialSound);c&&(c.stop(),i.current=setTimeout(()=>c.play(),250))}t.music!=null?l(t.music):r(d),t.newFunctions!=null&&t.newFunctions.length>0&&S(t.newFunctions)},[s,l,n,S,r]),C=o.useCallback(()=>{if(!e)throw new Error("Could not get current scene.");const{nextScene:t}=e;if(t==null)throw new Error("Could not get next scene.");a(t)},[e,a]),k=o.useCallback(()=>{r(d),n.navigate("hub")},[n,r]),v=o.useCallback(()=>{n.navigate("title");let t=null;return t&&clearTimeout(t),t=setTimeout(()=>{l("prelude")},F),()=>{t&&clearTimeout(t)}},[l,n]),T=o.useCallback(()=>{const t=u.filter(f=>f.unlocked);if(t.length===0)throw new Error("Could not find any unlocked journal pages.");const c=t.filter(f=>!f.completed),N=c.length>0?c[0]:t[t.length-1];a(N)},[u,a]),p=o.useCallback(t=>{r(d),n.navigate("cutscene",{cutsceneId:t})},[n,r]);return{navigateToScene:a,navigateToNextScene:C,navigateToHub:k,navigateToTitle:v,navigateToNextJournalPage:T,navigateToCutscene:p}}export{U as a,_ as b,O as c,L as d,y as e,D as f,j as u};
