import{r as t,l as G,cH as y,cI as l,cF as T,k as A}from"./index-2331aba4.js";const v="/assets/prelude-3f0462a2.ogg",O="/assets/prelude-4bf55512.mp3",V="/assets/getting_off_the_ground-cf6592ac.ogg",F="/assets/getting_off_the_ground-b63564a1.mp3",J="/assets/drifting_into_space-8647b454.ogg",P="/assets/drifting_into_space-16dcf567.mp3",R="/assets/looking_ahead-eae08aeb.ogg",j="/assets/looking_ahead-57ffd4d5.mp3",z="/assets/measuring_the_challenge-3748b4a5.ogg",D="/assets/measuring_the_challenge-7936e235.mp3",N="/assets/putting_it_all_together-b2a03f94.ogg",U="/assets/putting_it_all_together-8eeaeec1.mp3",q="/assets/not_the_end-347d8c93.ogg",L="/assets/not_the_end-abbd6a67.mp3",$=.5,H=4,K=t.createContext({requestSong:()=>{throw new Error("JukeboxContext not initialized")},stopSong:()=>{throw new Error("JukeboxContext not initialized")},stopAllMusic:()=>{throw new Error("JukeboxContext not initialized")},duckMusic:()=>{throw new Error("JukeboxContext not initialized")},unduckMusic:()=>{throw new Error("JukeboxContext not initialized")}});function B(S){const[o]=G(),[g,x]=t.useState(o.settings.masterVolume),[f,d]=t.useState(o.settings.musicVolume),[p,h]=t.useState(1),u=t.useRef(null);t.useEffect(()=>{x(o.settings.masterVolume),d(o.settings.musicVolume)},[o.settings.masterVolume,o.settings.musicVolume]);const m=t.useMemo(()=>y(g*f*p),[g,f,p]);t.useEffect(()=>{d(o.settings.musicVolume)},[o.settings.musicVolume]);const[X,C]=t.useState([]),s=t.useMemo(()=>({prelude:new l("prelude","music",[v,O],{loop:!0,fadeIn:4e3,preload:!1}),gettingOffTheGround:new l("gettingOffTheGround","music",[V,F],{loop:!0,fadeIn:10,preload:!1}),driftingIntoSpace:new l("driftingIntoSpace","music",[J,P],{loop:!0,fadeIn:10,preload:!1}),lookingAhead:new l("lookingAhead","music",[R,j],{loop:!0,fadeIn:10,preload:!1}),measuringTheChallenge:new l("measuringTheChallenge","music",[z,D],{loop:!0,fadeIn:10,preload:!1}),puttingItAllTogether:new l("puttingItAllTogether","music",[N,U],{loop:!0,fadeIn:10,preload:!1}),notTheEnd:new l("notTheEnd","music",[q,L],{loop:!0,fadeIn:10,preload:!1})}),[]),_=t.useCallback(e=>{C(n=>{let a=[...n];if(a.push(e),a=a.reverse().filter((r,I)=>a.indexOf(r)===I).reverse(),a.length>H){const r=a.shift();r&&s[r].unload()}return a})},[s]),c=t.useCallback(()=>{for(const[e,n]of Object.entries(s))if(n.isPlaying())return e;return null},[s]);t.useEffect(()=>{Object.values(s).filter(e=>e.category==="music").forEach(e=>{e.setCatGain(m)})},[m,s]);const i=t.useCallback(e=>{Object.values(s).filter(n=>n.category==="music").forEach(n=>{n.isPlaying()&&n.stop(e)})},[s]),b=t.useCallback(e=>{if(s[e]==null)throw new Error(`No song with id ${e}`);if(c()===e)return;const n=s[e];c()!==null?(i(T),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{n.play()},T)):n.play(),_(e)},[c,s,_,i]),k=t.useCallback(e=>{if(e in s)s[e].stop();else throw new Error(`No song with id ${e}`)},[s]),w=t.useCallback(()=>{h($)},[]),E=t.useCallback(()=>{h(1)},[]),M=t.useMemo(()=>({requestSong:b,stopSong:k,stopAllMusic:i,duckMusic:w,unduckMusic:E}),[b,k,w,i,E]);return A.jsx(K.Provider,{value:M,children:S.children})}export{K as JukeboxContext,B as JukeboxProvider};
